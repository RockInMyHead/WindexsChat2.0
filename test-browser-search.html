<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Browser Search</title>
</head>
<body>
    <h1>Test Browser Search Logic</h1>
    <button onclick="testSearch()">Test Search</button>
    <div id="result"></div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–µ–±-–ø–æ–∏—Å–∫–∞
        const requiresWebSearch = (query) => {
          const lowerQuery = query.toLowerCase();
          console.log('üîç requiresWebSearch called with query:', query, 'lowerQuery:', lowerQuery);

          // –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–æ–∏—Å–∫–∞
          const isVerySimpleQuery = ['–ø—Ä–∏–≤–µ—Ç', 'hi', 'hello', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ', '—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é', '–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è', '–ø—Ä–æ—â–∞–π', '–¥–∞', '–Ω–µ—Ç', '–∞–≥–∞', '—É–≥—É', '—Ö–æ—Ä–æ—à–æ', '–ø–ª–æ—Ö–æ', '–Ω–æ—Ä–º–∞–ª—å–Ω–æ', '–æ–∫', '–æ–∫–µ–π', '–ª–∞–¥–Ω–æ', '–ø–æ–Ω—è—Ç–Ω–æ', '—è—Å–Ω–æ', '–ø–æ–Ω—è–ª', '—Ö–æ—Ä–æ—à–æ'].some(simple =>
            lowerQuery.trim() === simple ||
            lowerQuery.trim().startsWith(simple + ' ') ||
            lowerQuery.trim().endsWith(' ' + simple) ||
            lowerQuery.trim().includes(' ' + simple + ' ')
          );

          const isTooShort = lowerQuery.trim().length < 3;
          const isOnlyEmojis = /^[\p{Emoji}\s]+$/u.test(lowerQuery.trim());

          if (isVerySimpleQuery || isTooShort || isOnlyEmojis) {
            console.log('üîç Simple query detected, no search needed');
            return false;
          }

          // –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
          const financialMatch = /(–∫—É—Ä—Å|—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç|—Ü–µ–Ω—ã|–≤—ã–ø–ª–∞—Ç|–∫—Ä–µ–¥–∏—Ç|—Å—Ç–∞–≤–∫–∞|–ø—Ä–æ—Ü–µ–Ω—Ç|–¥–æ—Ö–æ–¥|–Ω–∞–ª–æ–≥|—Å–±–æ—Ä|–≤–∑–Ω–æ—Å)/i.test(lowerQuery);
          const cryptoMatch1 = /(–±–∏—Ç–∫–æ–∏–Ω|–¥–æ–ª–ª–∞—Ä|–µ–≤—Ä–æ|—Ä—É–±–ª—å|–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç|–∫—Ä–∏–ø—Ç–æ|—Ü–µ–Ω–Ω–∞—è –±—É–º–∞–≥–∞|–∞–∫—Ü–∏—è|–æ–±–ª–∏–≥–∞—Ü–∏—è)/i.test(lowerQuery);
          const cryptoMatch2 = /(–±–∏—Ç–∫–æ–∏–Ω|–±–∏—Ç–∫–æ–π–Ω)/i.test(lowerQuery);
          const tickerMatch = /\b(btc|eth|bnb|ada|sol|dot|avax|matic|link|uni|usdc|usdt)\b/i.test(lowerQuery);

          console.log('üîç Financial checks:', { financialMatch, cryptoMatch1, cryptoMatch2, tickerMatch });

          if (financialMatch || cryptoMatch1 || cryptoMatch2 || tickerMatch) {
            console.log('üîç requiresWebSearch: TRUE for financial/crypto query');
            return true;
          }

          console.log('üîç requiresWebSearch result: false for query:', query);
          return false;
        };

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞
        async function testSearch() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing search logic...';

            const query = '–∫—É—Ä—Å –±–∏—Ç–∫–æ–π–Ω–∞';
            const needsSearch = requiresWebSearch(query);

            resultDiv.innerHTML += `<br>Query: "${query}"<br>Needs search: ${needsSearch}`;

            if (needsSearch) {
                resultDiv.innerHTML += '<br>Attempting MCP search...';

                try {
                    console.log('üåê Calling MCP API directly at:', window.location.origin + '/api/mcp/search');
                    const mcpResponse = await fetch('/api/mcp/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            query: query,
                            max_results: 2
                        })
                    });

                    console.log('üåê MCP fetch completed, status:', mcpResponse.status);

                    if (mcpResponse.ok) {
                        const data = await mcpResponse.json();
                        console.log('üåê MCP response data:', data);
                        resultDiv.innerHTML += `<br>‚úÖ Success! Answer: ${data.answer || 'No answer'}`;
                    } else {
                        const errorText = await mcpResponse.text();
                        console.error('‚ùå MCP API error:', mcpResponse.status, errorText);
                        resultDiv.innerHTML += `<br>‚ùå MCP API error ${mcpResponse.status}: ${errorText}`;
                    }
                } catch (error) {
                    console.error('‚ùå Fetch error:', error);
                    resultDiv.innerHTML += `<br>‚ùå Fetch error: ${error.message}`;
                }
            } else {
                resultDiv.innerHTML += '<br>üö´ Search not needed';
            }
        }

        // Auto test on load
        window.onload = () => {
            console.log('Browser test page loaded');
        };
    </script>
</body>
</html>
